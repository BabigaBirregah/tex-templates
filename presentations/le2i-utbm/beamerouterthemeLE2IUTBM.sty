% Copyright (c) 2013-15 Stephane GALLAND <galland@arakhne.org>
%
% UTBM logo and name are registered and owned by the
% "Universite de Technology of Belfort-Montbeliard".
%
% L2EI logo and name are registered and owned by the
% "Universite de Bourgogne".
% CNRS logo and name are registered and owned by the
% "Centre National de la Recherche Scientifique".
% 
% This program is free library; you can redistribute it and/or modify
% it under the terms of the GNU Lesser General Public License as
% published by the Free Software Foundation; either version 3 of the
% License, or any later version.
%
% This library is distributed in the hope that it will be useful, but
% WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
% Lesser General Public License for more details.
%
% You should have received a copy of the GNU Lesser General Public
% License along with this library; see the file COPYING.  If not,
% write to the Free Software Foundation, Inc., 59 Temple Place - Suite
% 330, Boston, MA 02111-1307, USA.
%
\ProvidesPackage{beamerouterthemeLE2IUTBM}
   [2015/09/01 Beamer Outer 'LE2I at UTBM' Theme]

\mode<presentation>

\useoutertheme{default}

\gdef\beamer@theme@leiiutbm@outer@offsety{0}

\newlength\beamer@theme@leiiutbm@outer@linewidth
\setlength\beamer@theme@leiiutbm@outer@linewidth{\paperwidth}
\addtolength{\beamer@theme@leiiutbm@outer@linewidth}{-2em}

\newlength\beamer@theme@leiiutbm@outer@titlewidth
\setlength\beamer@theme@leiiutbm@outer@titlewidth{\paperwidth}
\addtolength{\beamer@theme@leiiutbm@outer@titlewidth}{-6.5em}

\newlength\beamer@theme@leiiutbm@outer@titlewidth@plain
\setlength\beamer@theme@leiiutbm@outer@titlewidth@plain{\textwidth}

\newlength\beamer@theme@leiiutbm@outer@sideboxwidth
\setlength\beamer@theme@leiiutbm@outer@sideboxwidth{6.8cm}

\pgfdeclareimage[height=.5cm]{le2ilogoinpartners}{le2ilogo}
\pgfdeclareimage[height=.5cm]{utbmlogoinpartners}{utbmlogo}
\pgfdeclareimage[height=.5cm]{cnrslogoinpartners}{cnrslogo}

% No navigation symbols
\setbeamertemplate{navigation symbols}{}

\newcommand{\beamer@theme@leiiutbm@outer@background}{%
		\begin{tikzpicture}%
		\fill[LE2IUTBMdarkgray](0,0) rectangle (13,1);%
		\fill[LE2IUTBMdarkgray](0,0) rectangle (13,1);%
		\fill[LE2IUTBMlightblue](0,0.15) rectangle (13,0.05);%
		\fill[white](0,0.15) rectangle (13,0.17);%
		\end{tikzpicture}%
}

\setbeamertemplate{title page}{%
		\expandafter\begin{picture}(0,0)(0,\beamer@theme@leiiutbm@outer@offsety)%
		% Header
		\put(-28.4,91.8){%
			\beamer@theme@leiiutbm@outer@background%
		}%
		\put(-26.5,98.3){%
			\beamer@theme@leiiutbm@headline@currentpicture%
		}%
		% Title
		\put(-20,0){\usebeamercolor[fg]{maintitle}\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{%
			\nohyphens{\begin{center}\LARGE\textbf{\@beamer@theme@leiiutbm@wraptextformats{\inserttitle}}%
			\ifthenelse{\boolean{beamer@theme@leiiutbm@eventintitlebar}}{%
				\ifthenelse{\equal{a\insertsubtitle}{a}}{%
					\ifthenelse{\equal{a\inserteventname}{a}}{%
					}{%
						\\[.5em]\footnotesize\inserteventname%
					}%
				}{%
					\\[.5em]\footnotesize\insertsubtitle%
				}%
			}{%
				\ifthenelse{\equal{a\insertsubtitle}{a}}{}{%
					\\[.5em]\footnotesize\insertsubtitle%
				}
			}%
			\end{center}}}}%
		% Authors and event
		\put(-20,-80){\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{\begin{center}
			{\usebeamercolor[fg]{author}\large\bf\insertauthor}
			\ifthenelse{\boolean{beamer@theme@leiiutbm@eventintitlebar}}{%
				\ifthenelse{\equal{a\insertsubtitle}{a}}{}{%
					\ifthenelse{\equal{a\inserteventname}{a}}{{}}{\\[.1cm]\usebeamercolor[fg]{author}\footnotesize\inserteventname}%
				}%
			}{%
				\ifthenelse{\equal{a\inserteventname}{a}}{}{%
					\\\usebeamercolor[fg]{author}\footnotesize\inserteventname%
				}%
			}%
			\end{center}}}%
		% Separation line
		\put(-28.45,-152.9){%
			\begin{tikzpicture}%
			\draw[white] (0,0) -- (13,0);
			\draw[LE2IUTBMblue] (0.2,0.6) -- (12.6,0.6);
			\end{tikzpicture}%
		}%
		% Institute
		\put(-20,-147){\tiny\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{\begin{flushleft}%
			{\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute}\end{flushleft}}}%
		% Partner logos
		\put(175,-151.7){\parbox[b]{5.4cm}{\mbox{}\hfill%
					\beamer@theme@leiiutbm@partnerlogo\hspace{.1cm}%
					\pgfuseimage{le2ilogoinpartners}\hspace{.1cm}%
					\pgfuseimage{utbmlogoinpartners}\hspace{.1cm}%
					\pgfuseimage{cnrslogoinpartners}%
					}}%
		\end{picture}%
}

\setbeamertemplate{frametitle}{%
		\ifbeamer@plainframe%
			\begin{picture}(0,40)(0,0)%
			% Header
			\put(5,26){\usebeamercolor[fg]{plain frametitle}%
				\parbox[c]{\beamer@theme@leiiutbm@outer@titlewidth@plain}{%
				\nohyphens{\begin{flushleft}\large\bf\@beamer@theme@leiiutbm@wraptextformats{\insertframetitle}%
				\ifthenelse{\equal{a\insertframesubtitle}{a}}{{}}{%
					\usebeamercolor[fg]{plain framesubtitle}\small\bf~--~\@beamer@theme@leiiutbm@wraptextformats{\insertframesubtitle}}%
				\end{flushleft}}%
			}}%
			\end{picture}%
		\else%
			\begin{picture}(0,40)(0,0)%
			% Header
			\put(5,26){\usebeamercolor[fg]{frametitle}%
				\parbox[c]{\beamer@theme@leiiutbm@outer@titlewidth}{%
				\nohyphens{\begin{flushleft}\large\bf\@beamer@theme@leiiutbm@wraptextformats{\insertframetitle}%
				\ifthenelse{\equal{a\insertframesubtitle}{a}}{{}}{%
					\usebeamercolor[fg]{framesubtitle}\small\bf~--~\@beamer@theme@leiiutbm@wraptextformats{\insertframesubtitle}}%
				\end{flushleft}}%
			}}%
			% Side note
			\ifx\beamer@theme@leiiutbm@sidenote\relax\else%
				\put(328,-210){\rotatebox{90}{\parbox[c]{\beamer@theme@leiiutbm@outer@sideboxwidth}{%
						\usebeamerfont{sidenote}\usebeamercolor[fg]{sidenote}%
						\beamer@theme@leiiutbm@sidenote%
				}}}%
				\global\let\beamer@theme@leiiutbm@sidenote\relax%
			\fi%
			% Absolute elements
			\beamer@theme@leiiutbm@insertabsolutepositionelements%
			% Frame number
			\put(292,26){\parbox[c]{3em}{%
				{\mbox{}\hfill\usebeamercolor[fg]{frametitle}\tiny\insertframenumbering}%
			}}%
			% Partner logo
			\put(175,-231){\parbox[b]{5.4cm}{\mbox{}\hfill%
					\beamer@theme@leiiutbm@partnerlogo\hspace{.1cm}%
					\pgfuseimage{le2ilogoinpartners}\hspace{.1cm}%
					\pgfuseimage{utbmlogoinpartners}\hspace{.1cm}%
					\pgfuseimage{cnrslogoinpartners}%
					}}%
			\end{picture}%
		\fi%
}

\gdef\beamer@theme@leiiutbm@outer@footline{%
	\ifbeamer@plainframe\else%
	\begin{picture}(0,25)(0,0)%
		% Separation line
		\put(0,0){%
			\begin{tikzpicture}%
			\draw[white] (0,0) -- (13,0);
			\draw[LE2IUTBMblue] (0.2,0.6) -- (12.6,0.6);
			\end{tikzpicture}%
		}%
		% Left text
		\put(6,7){
				\parbox[c]{\beamer@theme@leiiutbm@outer@titlewidth}{%
				\begin{flushleft}%
				\usebeamerfont{author in head/foot}\usebeamercolor[fg]{author in head/foot}%
				\insertshortauthor%
				\@beamer@theme@leiiutbm@postfix{~--~}{\insertshorteventname}%
				\insertshortinstitute\end{flushleft}}}%
	\end{picture}%
	\fi%
}

\setbeamertemplate{part page}{%
		\begin{picture}(0,0)(0,0)%
		% Separation line
		\put(-28.45,-167.3){%
			\begin{tikzpicture}%
			\draw[white] (0,0) -- (13,0);
			\draw[LE2IUTBMblue] (0.2,0.6) -- (12.6,0.6);
			\end{tikzpicture}%
		}%
		% Institute
		\put(-20,-161){\tiny\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{\begin{flushleft}%
			{\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute}\end{flushleft}}}%
		% Partners
		\put(175,-166.2){\parbox[b]{5.4cm}{\mbox{}\hfill%
					\beamer@theme@leiiutbm@partnerlogo\hspace{.1cm}%
					\pgfuseimage{le2ilogoinpartners}\hspace{.1cm}%
					\pgfuseimage{utbmlogoinpartners}\hspace{.1cm}%
					\pgfuseimage{cnrslogoinpartners}%
					}}%
		% Title
		\put(-20,-39){\usebeamercolor[fg]{maintitle}\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{%
			\nohyphens{\begin{center}\LARGE\textbf{\@beamer@theme@leiiutbm@wraptextformats{{\insertpartprefix}\beamer@partname}}%
		\end{center}}}}%
		% Author
		\ifbeamer@theme@leiiutbm@part@hasauthor%
		\put(-20,-95){\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{\begin{center}
			{\usebeamercolor[fg]{author}\large\bf\beamer@theme@leiiutbm@part@theauthor}
			\end{center}}}%
		\fi%
		\end{picture}%
}

\newcommand{\beamer@theme@leiiutbm@outer@thanksslide}{%
	\beamer@theme@leiiutbm@nav@advancesection%
	\xdef\beamer@theme@leiiutbm@totalcoreframenumber{\the\c@framenumber}
	\addtocounter{section}{1}% To be sure that the 'thank' slide is not in the same section as the previous slide.
	\setbeamertemplate{footline}{}
	\usebackgroundtemplate{\beamer@theme@leiiutbm@outer@background}%
	%\useheaderempty
	\frame{
		% Copy of the title page
		\ifthenelse{\value{@beamer@theme@leiiutbm@finalslidelabel}=3}{%
			\gdef\beamer@theme@leiiutbm@outer@offsety{14.4}%
			\usebeamertemplate{title page}%
			\gdef\beamer@theme@leiiutbm@outer@offsety{0}%
		}{%
			\begin{picture}(0,10)(0,0)%
				% Message
				\put(-20,-38.5){\usebeamercolor[fg]{maintitle}\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{%
					\nohyphens{\begin{center}\LARGE\textbf{%
						\ifcase\value{@beamer@theme@leiiutbm@finalslidelabel}%
							\translate{Thanks}%
						\or%
							\translate{Questions}%
						\or%
							\beamer@theme@leiiutbm@label@finalslidelabel%
						\else%
							\errmessage{Package Beamer/LE2I-UTBM: Unsupported type of message for the final slide.}%
						\fi%
					}\end{center}}}}%
				% Separation line
				\put(-28.45,-167.3){%
					\begin{tikzpicture}%
					\draw[white] (0,0) -- (13,0);
					\draw[LE2IUTBMblue] (0.2,0.6) -- (12.6,0.6);
					\end{tikzpicture}%
				}%
				% Institute
				\put(-20.5,-161.5){\tiny\parbox[c]{\beamer@theme@leiiutbm@outer@linewidth}{\begin{flushleft}%
					{\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute}\end{flushleft}}}%
				% Partner logos
				\put(175,-166.15){\parbox[b]{5.4cm}{\mbox{}\hfill%
							\beamer@theme@leiiutbm@partnerlogo\hspace{.1cm}%
							\pgfuseimage{le2ilogoinpartners}\hspace{.1cm}%
							\pgfuseimage{utbmlogoinpartners}\hspace{.1cm}%
							\pgfuseimage{cnrslogoinpartners}%
							}}%
			\end{picture}%
		}%
	}%
	\usebackgroundtemplate{\ifbeamer@plainframe\else\beamer@theme@leiiutbm@outer@background\fi}%
	\setbeamertemplate{footline}{\beamer@theme@leiiutbm@outer@footline}%
	%\useheaderdefault%
}

\setbeamertemplate{frametitle continuation}{%
	{\smaller(\#\insertcontinuationcount)}%
}

\mode
<all>
